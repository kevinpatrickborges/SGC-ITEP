<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>SGD-ITEP - Login</title>
  <link rel="stylesheet" href="/css/login-styles.css">
  <link rel="stylesheet" href="/css/loading.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
</head>
<body>
  
  <div class="header-sei">
    <div class="header-top">GOVERNO DO ESTADO DO RIO GRANDE DO NORTE</div>
    <div class="header-divider"></div>
    <div class="header-main">Sistema Integrado de Gestão Documental ITEP</div>
  </div>

  <div class="main-login-wrapper">
    <div class="box">
      <div class="logo-wrapper">
        <img src="/img/itep_logo.png" alt="ITEP" class="login-logo">
        <div class="login-title">Instituto Técnico-Científico de Perícia</div>
        <div class="login-subtitle">Acesso restrito ao sistema</div>
      </div>

      <form action="/auth/login" method="POST" autocomplete="off" id="loginForm">
        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
        
        <label for="matricula" class="sr-only">Usuário</label>
        <div class="input-group input-group-lg">
          <span class="input-group-text"><i class="bi bi-person-badge"></i></span>
          <input type="text" class="form-control" id="matricula" name="matricula" required placeholder="Usuário">
        </div>

        <label for="senha" class="sr-only">Senha</label>
        <div class="input-group input-group-lg">
          <span class="input-group-text"><i class="bi bi-lock"></i></span>
          <input type="password" class="form-control" id="senha" name="senha" required placeholder="Senha">
        </div>

        <button type="submit" class="btn login-btn">
          <i class="bi bi-box-arrow-in-right me-1"></i> Entrar
        </button>

        <% if (typeof error_msg === 'string' && error_msg.trim().length > 0) { %>
  <div id="popup-overlay" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.25);z-index:9999;display:flex;align-items:center;justify-content:center;">
    <div style="background:#fff;padding:24px 32px;border-radius:12px;box-shadow:0 4px 24px rgba(0,0,0,0.12);min-width:320px;max-width:90vw;position:relative;">
      <button onclick="document.getElementById('popup-overlay').style.display='none'" style="position:absolute;top:8px;right:12px;border:none;background:transparent;font-size:1.5em;line-height:1;color:#888;cursor:pointer;">&times;</button>
      <div class="alert alert-danger mb-0 p-2" role="alert" style="font-size:1em;text-align:center;">
        <i class="bi bi-exclamation-triangle-fill me-1"></i> <%= error_msg %>
      </div>
    </div>
  </div>
<% } %>      <% if (success_msg) { %>
          <div class="alert alert-success"><%= success_msg %></div>
        <% } %>
      </form>
    </div>
  </div>

  <div class="login-footer">
    Núcleo de Gestão de Conhecimento e Informação Documentação e Memória.<br>
    Instituto Técnico-Científico de Perícia - ITEP.<br>
    &copy; <%= new Date().getFullYear() %> - Todos os direitos reservados
  </div>
  
  <!-- Tela de carregamento (inicialmente oculta) -->
  <div id="loading-overlay" class="loading-overlay loading-hidden">
    <img src="/img/itep_logo.png" alt="ITEP" class="loading-logo">
    <div class="loading-spinner"></div>
    <div class="loading-text">Autenticando, por favor aguarde...</div>
  </div>
  <script>
    // M'ostrar a tela de carregamento quando o formulário for enviado
    document.addEventListener('DOMContentLoaded', function() {
      const loginForm = document.getElementById('loginForm');
      const loadingOverlay = document.getElementById('loading-overlay');
      
      if (loginForm && loadingOverlay) {
        loginForm.addEventListener('submit', function(event) {
          // Verifica se os campos estão preenchidos
          const matricula = document.getElementById('matricula').value.trim();
          const senha = document.getElementById('senha').value.trim();
          
          if (matricula && senha) {
            // Remove a classe que esconde o overlay
            loadingOverlay.classList.remove('loading-hidden');
            
            // Simula um tempo mínimo de carregamento (mesmo que o servidor responda rápido)
            // Isso garante que o usuário veja a tela de carregamento
            setTimeout(function() {
              // O formulário será enviado normalmente após o timeout
              // Se o servidor demorar mais que isso, a tela continuará sendo exibida
            }, 1000);
          }
        });
      }
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
</body>
</html>
