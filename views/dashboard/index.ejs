<div class="dashboard-container">
    <h2 class="dashboard-title">Dashboard Analítico</h2>
    <p class="dashboard-subtitle">Visão geral do sistema de gestão de desarquivamentos</p>

    <!-- Cards de estatísticas minimalistas -->
    <div class="row mb-4">
      <div class="col-xl-3 col-md-6 mb-4">
        <a href="/desarquivamentos" class="stat-card-link">
          <div class="stat-card h-100">
            <div class="card-body">
              <div class="card-title">Total de Registros</div>
              <div class="card-value"><%= totalDesarquivamentos %></div>
            </div>
          </div>
        </a>
      </div>
      <div class="col-xl-3 col-md-6 mb-4">
        <a href="/desarquivamentos?status=Em+Posse" class="stat-card-link">
          <div class="stat-card h-100">
            <div class="card-body">
              <div class="card-title">Em Posse</div>
              <div class="card-value"><%= desarquivamentosEmPosse %></div>
            </div>
          </div>
        </a>
      </div>
      <div class="col-xl-3 col-md-6 mb-4">
        <a href="/desarquivamentos?recent=true" class="stat-card-link">
          <div class="stat-card h-100">
            <div class="card-body">
              <div class="card-title">Solicitações Recentes</div>
              <div class="card-value"><%= solicitacoesRecentes %></div>
            </div>
          </div>
        </a>
      </div>
      <div class="col-xl-3 col-md-6 mb-4">
        <a href="/desarquivamentos?status=Urgente" class="stat-card-link">
          <div class="stat-card h-100">
            <div class="card-body">
              <div class="card-title">Atenção Urgente</div>
              <div class="card-value"><%= vestigiosUrgentes %></div>
            </div>
          </div>
        </a>
      </div>
    </div>

    <!-- Tabelas lado a lado -->
    <div class="row">
      <!-- Tabela de registros recentes -->
      <div class="col-lg-8 mb-4">
        <div class="card h-100">
          <div class="card-header">
            <h4 class="card-title mb-0">Registros Recentes</h4>
          </div>
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-bordered table-hover recent-table mb-0">
                <thead>
                  <tr>
                    <th>Nome Completo</th>
                    <th>Nº Documento</th>
                    <th>Status</th>
                    <th>Data</th>
                  </tr>
                </thead>
                <tbody>
                  <% if (registrosRecentes && registrosRecentes.length > 0) { %>
                    <% registrosRecentes.forEach(function(registro) { %>
                      <tr onclick="window.location='/desarquivamentos/<%= registro.id %>';" style="cursor: pointer;">
                        <td><%= registro.nomeCompleto %></td>
                        <td><%= registro.numDocumento %></td>
                        <td><span class="badge bg-light text-dark"><%= registro.status %></span></td>
                        <td><%= new Date(registro.createdAt).toLocaleDateString('pt-BR') %></td>
                      </tr>
                    <% }); %>
                  <% } else { %>
                    <tr>
                      <td colspan="4" class="text-center">Nenhum registro encontrado</td>
                    </tr>
                  <% } %>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Seção de usuários ativos -->
      <div class="col-lg-4 mb-4">
        <div class="card h-100">
          <div class="card-header">
            <h4 class="card-title mb-0">Usuários Ativos</h4>
          </div>
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-bordered table-hover recent-table mb-0">
                <thead>
                  <tr>
                    <th>IP</th>
                    <th>Conexões</th>
                  </tr>
                </thead>
                <tbody>
                  <% if (usersByIp && Object.keys(usersByIp).length > 0) { %>
                    <% Object.entries(usersByIp).forEach(function([ip, count]) { %>
                      <tr>
                        <td><%= (ip === '::1' || ip === '127.0.0.1') ? 'localhost' : ip %></td>
                        <td><%= count %></td>
                      </tr>
                    <% }) %>
                  <% } else { %>
                    <tr>
                      <td colspan="2" class="text-center">Nenhum usuário ativo</td>
                    </tr>
                  <% } %>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
